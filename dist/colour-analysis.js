var ColourAnalysis=function(e){var i={};function t(r){if(i[r])return i[r].exports;var a=i[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=i,t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var a in e)t.d(r,a,function(i){return e[i]}.bind(null,a));return r},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},t.p="",t(t.s=0)}([function(e,i,t){"use strict";t.r(i);var r=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var i=Object.prototype.toString.call(e);return"[object RegExp]"===i||"[object Date]"===i||function(e){return e.$$typeof===a}(e)}(e)};var a="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function o(e,i){return!1!==i.clone&&i.isMergeableObject(e)?c(function(e){return Array.isArray(e)?[]:{}}(e),e,i):e}function s(e,i,t){return e.concat(i).map(function(e){return o(e,t)})}function c(e,i,t){(t=t||{}).arrayMerge=t.arrayMerge||s,t.isMergeableObject=t.isMergeableObject||r;var a=Array.isArray(i);return a===Array.isArray(e)?a?t.arrayMerge(e,i,t):function(e,i,t){var r={};return t.isMergeableObject(e)&&Object.keys(e).forEach(function(i){r[i]=o(e[i],t)}),Object.keys(i).forEach(function(a){t.isMergeableObject(i[a])&&e[a]?r[a]=c(e[a],i[a],t):r[a]=o(i[a],t)}),r}(e,i,t):o(i,t)}c.all=function(e,i){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,t){return c(e,t,i)},{})};var n=c;function u(e){return void 0!=window.colourAnalysisServer?`${window.colourAnalysisServer}${e}`:e}function l(e,i){for(;void 0!=e.getObjectByName(i);){var t=e.getObjectByName(i);t.parent.remove(t)}}function h(e,i,t,r,a){null!=i&&void 0!=i&&(i.innerText=e,function(e,i){for(e.style.opacity=1;i.length>0;){var t=i.shift();window.clearInterval(t),window.clearTimeout(t)}}(i,t),function(e,i,t,r){t=t||5e3,r=r||10,i.push(setTimeout(function(){e.style.opacity=1;var t=setInterval(function(){var i=e.style.opacity;0==i?clearInterval(t):e.style.opacity=i-.01},r);i.push(t)},t))}(i,t,r,a))}function p(e,i,t){h(e,document.getElementById("info"),window.info_id_registry,i,t)}function m(e,i,t){h(e,document.getElementById("warning"),window.warning_id_registry,i,t)}function d(e){var i=Math.round(e.loaded/parseFloat(e.target.getResponseHeader("x-content-length"))*100);p(`${this.name}: ${i}% loaded...`)}function g(e){var i=e.split(".");return["exr","hdr"].indexOf(i[i.length-1].toLowerCase())>=0}window.info_id_registry=new Array,window.warning_id_registry=new Array;var _=function(e,i){var t=document.createElement("a");"string"==typeof t.download?(document.body.appendChild(t),t.download=i,t.href=e,t.click(),document.body.removeChild(t)):location.replace(uri)};class y{constructor(e,i){this._container=e,i=n({renderer:{antialias:!0}},i||{}),this._renderer=new THREE.WebGLRenderer({antialias:i.renderer.antialias}),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(this._container.clientWidth,this._container.clientHeight),this._container.appendChild(this._renderer.domElement),this._scene=new THREE.Scene,this._observer=new MutationObserver(this.resizeToContainer.bind(this)),this._observer.observe(this._container,{attributes:!0}),window.addEventListener("resize",this.resizeToContainer.bind(this),!1)}get container(){return this._container}set container(e){throw new Error('"container" property is read only!')}get renderer(){return this._renderer}set renderer(e){throw new Error('"renderer" property is read only!')}get scene(){return this._scene}set scene(e){throw new Error('"scene" property is read only!')}capture(){return this.render(),this._renderer.domElement.toDataURL("image/png")}removeObjectByName(e){l(this._scene,e)}resizeToContainer(){var e=this._container.clientWidth,i=this._container.clientHeight;this._container.width===e&&this._container.height===i||this._renderer.setSize(e,i)}animate(){requestAnimationFrame(this.animate.bind(this)),this._controls.update(),this.render()}render(){this._renderer.render(this._scene,this._camera)}}class f extends y{constructor(e,i){super(e,i),i=n({camera:{fov:45,up:{x:0,y:1,z:0},near:.001,far:1e3}},i||{}),this._camera=new THREE.PerspectiveCamera(i.camera.fov,this.container.clientWidth/this.container.clientHeight,i.camera.near,i.camera.far),this._camera.name="perspective-camera",this._camera.up=new THREE.Vector3(i.camera.up.x,i.camera.up.y,i.camera.up.z),this._scene.add(this._camera),this._controls=new THREE.TrackballControls(this._camera,this.container)}get camera(){return this._camera}set camera(e){throw new Error('"camera" property is read only!')}get controls(){return this._controls}set controls(e){throw new Error('"controls" property is read only!')}resizeToContainer(){super.resizeToContainer();var e=this.container.clientWidth,i=this.container.clientHeight;this.container.width===e&&this.container.height===i||(this._camera.aspect=e/i,this._camera.updateProjectionMatrix())}}class C{constructor(e,i){this._parent=e,this._name=i.name||"visual",this._visible=i.visible||!0,this._loadingCallback=i.loadingCallback||d,this._cache={},this._visual=void 0,this._loading=!1}get parent(){return this._parent}set parent(e){void 0!=this._parent&&l(this._parent,this._name),this._parent=e,void 0!=this._visual&&this._parent.add(this._visual)}get name(){return this._name}set name(e){throw new Error('"name" property is read only!')}get visible(){return this._visible}set visible(e){this._visible=e,Object.keys(this._cache).forEach(function(i){this._cache[i].visible=e}.bind(this))}get loadingCallback(){return this._loadingCallback}set loadingCallback(e){this._loadingCallback=e}get cache(){return this._cache}set cache(e){throw new Error('"cache" property is read only!')}get visual(){return this._visual}set visual(e){void 0!=this._parent&&l(this._parent,this._name),this._visual=e,void 0!=this._visual&&this._parent.add(this._visual)}get loading(){return this._loading}set loading(e){throw new Error('"cache" property is read only!')}route(){throw Error("Method must be reimplemented in subclass!")}add(){void 0!=this._parent&&l(this._parent,this._name);var e=this.route();this._loading=!0,e in this._cache?(this._visual=this._cache[e],this._parent.add(this._visual),this._loading=!1):this.fetch(e)}create(e){throw Error("Method must be reimplemented in subclass!")}fetch(e){(new THREE.BufferGeometryLoader).load(e,function(i,t){this._visual=this.create(i),this._cache[e]=this._visual,this._parent.add(this._visual),this._loading=!1}.bind(this),this._loadingCallback.bind(this))}}class v extends C{constructor(e,i){super(e.camera,n({name:"view-axes-visual"},i||{})),this._view=e,this._colourspaceModel=i.colourspaceModel||"CIE xyY"}get view(){return this._view}set view(e){throw new Error('"view" property is read only!')}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e,this.add()}route(){return u(`/colourspace-models?colourspaceModel=${encodeURIComponent(this._colourspaceModel)}`)}create(e){var i=new THREE.AxesHelper;return i.geometry.attributes.color.array.set([0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0]),i.name=this.name,i.visible=this.visible,(new THREE.FontLoader).load("https://cdn.rawgit.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json",function(t){[{text:e[this._colourspaceModel][0],colour:"#FF0000",position:{x:-.2,y:-.2,z:1.2}},{text:e[this._colourspaceModel][1],colour:"#00FF00",position:{x:-.2,y:1.2,z:-.05}},{text:e[this._colourspaceModel][2],colour:"#0000FF",position:{x:1.2,y:-.2,z:-.05}}].forEach(function(e){var r=new THREE.TextGeometry(e.text,{font:t,size:.4,height:.1,curveSegments:8}),a=new THREE.MeshBasicMaterial({color:e.colour}),o=new THREE.Mesh(r,a);o.position.set(e.position.x,e.position.y,e.position.z),o.name=e.text,i.add(o)}.bind(this))}.bind(this)),i.onBeforeRender=function(e,i,t,r,a,o){var s=10*this._view.camera.near;this.visual.scale.set(s/20,s/20,s/20);var c=this._view.container.clientWidth/this._view.container.clientHeight,n=this._view.camera.fov*Math.PI/180,u=2*Math.atan(Math.tan(n/2)*c),l=2*Math.tan(u/2)*s,h=2*Math.tan(n/2)*s;this.visual.position.set(-l/2*.85,-h/2*.85,-s);var p=function(e,i){var t=new THREE.Vector3,r=new THREE.Vector3;t.copy(e.position),r.copy(i.target),t.sub(r);var a=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),o=Math.sqrt(t.x*t.x+t.z*t.z);return{x:Math.acos(o/a)*(t.y>0?1:-1),y:Math.acos(t.z/o)*(t.x>0?-1:1),z:0}}(this._view.camera,this._view.controls);this.visual.rotation.set(p.x,p.y,0)}.bind(this),i}fetch(e){var i=new THREE.FileLoader;i.setResponseType("json"),i.load(e,function(i){this.visual=this.create(i),this.cache[e]=this.visual,this._view.camera.add(this.visual),this._loading=!1}.bind(this),d.bind(this))}}class w extends C{constructor(e,i){super(e,n({name:"colourspace-visual"},i||{})),this._colourspace=i.colourspace||"sRGB",this._colourspaceModel=i.colourspaceModel||"CIE xyY",this._segments=i.segments||16,this._uniformColour=i.uniformColour||void 0,this._uniformOpacity=i.uniformOpacity||.75,this._wireframe=i.wireframe||!1,this._wireframeColour=i.wireframeColour||void 0,this._wireframeOpacity=i.wireframeOpacity||1}get colourspace(){return this._colourspace}set colourspace(e){this._colourspace=e,this.add()}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e,this.add()}get segments(){return this._segments}set segments(e){this._segments=e,this.add()}get uniformColour(){return this._uniformColour}set uniformColour(e){this._uniformColour=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.color=new THREE.Color(e)}.bind(this))}get uniformOpacity(){return this._uniformOpacity}set uniformOpacity(e){this._uniformOpacity=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.opacity=e}.bind(this))}get wireframe(){return this._wireframe}set wireframe(e){this._wireframe=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.wireframe=e}.bind(this))}get wireframeColour(){return this._wireframeColour}set wireframeColour(e){throw new Error('"wireframeOpacity" property is read only!')}get wireframeOpacity(){return this._wireframeOpacity}set wireframeOpacity(e){throw new Error('"wireframeOpacity" property is read only!')}route(){return u("/RGB-colourspace-volume-visual?"+`colourspace=${encodeURIComponent(this._colourspace)}&`+`colourspaceModel=${encodeURIComponent(this._colourspaceModel)}&`+`segments=${this._segments}&`+`wireframe=${this._wireframe}&`)}create(e){var i=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,transparent:!0,opacity:this._uniformOpacity,wireframe:this._wireframe});i.depthWrite=1==this._uniformOpacity;var t=new THREE.Mesh(e,i);return t.name=this.name,t.visible=this.visible,t}}class O extends C{constructor(e,i){super(e,n({name:"image-scatter-visual"},i||{})),this._image=i.image||"Rose.ProPhoto.jpg",this._primaryColourspace=i.primaryColourspace||"sRGB",this._secondaryColourspace=i.secondaryColourspace||"DCI-P3",this._imageColourspace=i.imageColourspace||"Primary",this._imageDecodingCctf=i.imageDecodingCctf||"sRGB",this._colourspaceModel=i.colourspaceModel||"CIE xyY",this._uniformColour=i.uniformColour||void 0,this._uniformOpacity=i.uniformOpacity||.75,this._outOfPrimaryColourspaceGamut=i.outOfPrimaryColourspaceGamut||!1,this._outOfSecondaryColourspaceGamut=i.outOfSecondaryColourspaceGamut||!1,this._outOfPointerGamut=i.outOfPointerGamut||!1,this._subSampling=i.subSampling||25,this._pointSize=i.pointSize||.01,this._saturate=i.saturate||!1}get image(){return this._image}set image(e){this._image=e,this.add()}get imageColourspace(){return this._imageColourspace}set imageColourspace(e){this._imageColourspace=e,this.add()}get primaryColourspace(){return this._primaryColourspace}set primaryColourspace(e){this._primaryColourspace=e,this.add()}get secondaryColourspace(){return this._secondaryColourspace}set secondaryColourspace(e){this._secondaryColourspace=e,this.add()}get imageColourspace(){return this._imageColourspace}set imageColourspace(e){if(!["Primary","Secondary"].includes(e))throw new Error('"imageColourspace" value must be one of ["Primary", "Secondary"]!');this._imageColourspace=e,this.add()}get imageDecodingCctf(){return this._imageDecodingCctf}set imageDecodingCctf(e){this._imageDecodingCctf=e,this.add()}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e,this.add()}get uniformColour(){return this._uniformColour}set uniformColour(e){this._uniformColour=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.color=new THREE.Color(e)}.bind(this))}get uniformOpacity(){return this._uniformOpacity}set uniformOpacity(e){this._uniformOpacity=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.opacity=e}.bind(this))}get outOfPrimaryColourspaceGamut(){return this._outOfPrimaryColourspaceGamut}set outOfPrimaryColourspaceGamut(e){this._outOfPrimaryColourspaceGamut=e,this.add()}get outOfSecondaryColourspaceGamut(){return this._outOfSecondaryColourspaceGamut}set outOfSecondaryColourspaceGamut(e){this._outOfSecondaryColourspaceGamut=e,this.add()}get outOfPointerGamut(){return this._outOfPointerGamut}set outOfPointerGamut(e){this._outOfPointerGamut=e,this.add()}get subSampling(){return this._subSampling}set subSampling(e){this._subSampling=e,this.add()}get pointSize(){return this._pointSize}set pointSize(e){this._pointSize=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.size=e}.bind(this))}get saturate(){return this._saturate}set saturate(e){this._saturate=e,this.add()}route(){return u(`/RGB-image-scatter-visual/${this._image}?`+`primaryColourspace=${encodeURIComponent(this._primaryColourspace)}&`+`secondaryColourspace=${encodeURIComponent(this._secondaryColourspace)}&`+`imageColourspace=${encodeURIComponent(this._imageColourspace)}&`+`imageDecodingCctf=${encodeURIComponent(this._imageDecodingCctf)}&`+`colourspaceModel=${encodeURIComponent(this._colourspaceModel)}&`+`outOfPrimaryColourspaceGamut=${this._outOfPrimaryColourspaceGamut}&`+`outOfSecondaryColourspaceGamut=${this._outOfSecondaryColourspaceGamut}&`+`outOfPointerGamut=${this._outOfPointerGamut}&`+`subSampling=${this._subSampling}&`+`saturate=${this._saturate}&`)}create(e){var i=new THREE.PointsMaterial({vertexColors:THREE.VertexColors,transparent:!0,opacity:this._uniformOpacity,size:this._pointSize}),t=new THREE.Points(e,i);return t.name=this.name,t.visible=this.visible,t}}class V extends C{constructor(e,i){super(e,n({name:"pointer-gamut-visual"},i||{})),this._colourspaceModel=i.colourspaceModel||"CIE xyY",this._uniformColour=i.uniformColour||5227511,this._uniformOpacity=i.uniformOpacity||.75}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e,this.add()}get uniformColour(){return this._uniformColour}set uniformColour(e){this._uniformColour=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.color=new THREE.Color(e)}.bind(this))}get uniformOpacity(){return this._uniformOpacity}set uniformOpacity(e){this._uniformOpacity=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.opacity=e}.bind(this))}route(){return u("/pointer-gamut-visual?"+`colourspaceModel=${encodeURIComponent(this._colourspaceModel)}&`)}create(e){var i=new THREE.LineBasicMaterial({color:this._uniformColour,transparent:!0,opacity:this._uniformOpacity}),t=new THREE.LineSegments(e,i);return t.name=this.name,t.visible=this.visible,t}}class E extends C{constructor(e,i){super(e,n({name:"spectral-locus-visual"},i||{})),this._colourspace=i.colourspace||"sRGB",this._colourspaceModel=i.colourspaceModel||"CIE xyY",this._uniformColour=i.uniformColour||void 0,this._uniformOpacity=i.uniformOpacity||.75}get colourspace(){return this._colourspace}set colourspace(e){this._colourspace=e,this.add()}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e,this.add()}get uniformColour(){return this._uniformColour}set uniformColour(e){this._uniformColour=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.color=new THREE.Color(e)}.bind(this))}get uniformOpacity(){return this._uniformOpacity}set uniformOpacity(e){this._uniformOpacity=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.opacity=e}.bind(this))}route(){return u("/spectral-locus-visual?"+`colourspace=${encodeURIComponent(this._colourspace)}&`+`colourspaceModel=${encodeURIComponent(this._colourspaceModel)}&`)}create(e){var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:!0,opacity:this._uniformOpacity}),t=new THREE.Line(e,i);return t.name=this.name,t.visible=this.visible,t}}class b extends C{constructor(e,i){super(e,n({name:"visible-spectrum-visual"},i||{})),this._colourspaceModel=i.colourspaceModel||"CIE xyY",this._uniformColour=i.uniformColour||16754470,this._uniformOpacity=i.uniformOpacity||.75}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e,this.add()}get uniformColour(){return this._uniformColour}set uniformColour(e){this._uniformColour=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.color=new THREE.Color(e)}.bind(this))}get uniformOpacity(){return this._uniformOpacity}set uniformOpacity(e){this._uniformOpacity=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.opacity=e}.bind(this))}route(){return u("/visible-spectrum-visual?"+`colourspaceModel=${encodeURIComponent(this._colourspaceModel)}&`)}create(e){var i=new THREE.LineBasicMaterial({color:this._uniformColour,transparent:!0,opacity:this._uniformOpacity}),t=new THREE.LineSegments(e,i);return t.name=this.name,t.visible=this.visible,t}}class M extends f{constructor(e,i){super(e,i),i=n({scene:{background:"#333333"},fog:{enable:!0,color:"#333333",density:.05},camera:{position:{x:-3,y:3,z:3}},controls:{target:{x:1/3,y:.5,z:1/3}},grid:{enable:!0,size:2,divisions:20,colorCenterLine:"#111111",colorGrid:"#222222"},axes:{enable:!0},image:"Rose.ProPhoto.jpg",primaryColourspace:"sRGB",secondaryColourspace:"DCI-P3",imageColourspace:"Primary",imageDecodingCctf:"sRGB",colourspaceModel:"CIE xyY"},i||{}),this.renderer.sortObjects=!1,this.scene.background=new THREE.Color(i.scene.background),i.fog.enable&&(this.scene.fog=new THREE.FogExp2(i.fog.color,i.fog.density)),this.camera.position.copy(new THREE.Vector3(i.camera.position.x,i.camera.position.y,i.camera.position.z)),this.controls.target=new THREE.Vector3(i.controls.target.x,i.controls.target.y,i.controls.target.z),i.grid.enable&&(this.grid=new THREE.GridHelper(i.grid.size,i.grid.divisions,i.grid.colorCenterLine,i.grid.colorGrid),this.grid.name="grid",this.scene.add(this.grid)),i.axes.enable&&(this.axes=new THREE.AxesHelper,this.axes.geometry.attributes.color.array.set([0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0]),this.axes.name="axes",this.scene.add(this.axes)),this._image=i.image,this._primaryColourspace=i.primaryColourspace,this._secondaryColourspace=i.secondaryColourspace,this._imageColourspace=i.imageColourspace,this._imageDecodingCctf=i.imageDecodingCctf,this._colourspaceModel=i.colourspaceModel,this._viewAxesVisual=void 0,this._visibleSpectrumVisualGroup=new THREE.Group,this._visibleSpectrumVisualGroup.name="visible-spectrum-visual-group",this._scene.add(this._visibleSpectrumVisualGroup),this._visibleSpectrumVisual=void 0,this._spectralLocusVisualGroup=new THREE.Group,this._spectralLocusVisualGroup.name="spectral-locus-visual-group",this._scene.add(this._spectralLocusVisualGroup),this._spectralLocusVisual=void 0,this._pointerGamutVisualGroup=new THREE.Group,this._pointerGamutVisualGroup.name="pointer-gamut-visual-group",this._scene.add(this._pointerGamutVisualGroup),this._pointerGamutVisual=void 0,this._secondaryColourspaceVisualGroup=new THREE.Group,this._secondaryColourspaceVisualGroup.name="secondary-colourspace-visual-group",this._scene.add(this._secondaryColourspaceVisualGroup),this._secondaryColourspaceVisual=void 0,this._primaryColourspaceVisualGroup=new THREE.Group,this._primaryColourspaceVisualGroup.name="primary-colourspace-visual-group",this._scene.add(this._primaryColourspaceVisualGroup),this._primaryColourspaceVisual=void 0,this._imageScatterVisualGroup=new THREE.Group,this._imageScatterVisualGroup.name="image-scatter-visual-group",this._scene.add(this._imageScatterVisualGroup),this._imageScatterVisual=void 0,this._imageScatterOverlayVisualGroup=new THREE.Group,this._imageScatterOverlayVisualGroup.name="image-scatter-overlay-visual-group",this._scene.add(this._imageScatterOverlayVisualGroup),this._imageScatterOverlayVisual=void 0}get image(){return this._image}set image(e){this._image=e,void 0!=this._imageScatterVisual&&(this._imageScatterVisual.image=e),void 0!=this._imageScatterOverlayVisual&&(this._imageScatterOverlayVisual.image=e)}get primaryColourspace(){return this._primaryColourspace}set primaryColourspace(e){this._primaryColourspace=e,void 0!=this._primaryColourspaceVisual&&(this._primaryColourspaceVisual.colourspace=e),void 0!=this._imageScatterVisual&&(this._imageScatterVisual.primaryColourspace=e),void 0!=this._imageScatterOverlayVisual&&(this._imageScatterOverlayVisual.primaryColourspace=e)}get secondaryColourspace(){return this._secondaryColourspace}set secondaryColourspace(e){this._secondaryColourspace=e,void 0!=this._secondaryColourspaceVisual&&(this._secondaryColourspaceVisual.colourspace=e),void 0!=this._imageScatterVisual&&(this._imageScatterVisual.secondaryColourspace=e),void 0!=this._imageScatterOverlayVisual&&(this._imageScatterOverlayVisual.secondaryColourspace=e)}get imageColourspace(){return this._imageColourspace}set imageColourspace(e){if(!["Primary","Secondary"].includes(e))throw new Error('"imageColourspace" value must be one of ["Primary", "Secondary"]!');this._imageColourspace=e,void 0!=this._imageScatterVisual&&(this._imageScatterVisual.imageColourspace=e),void 0!=this._imageScatterOverlayVisual&&(this._imageScatterOverlayVisual.imageColourspace=e)}get imageDecodingCctf(){return this._imageDecodingCctf}set imageDecodingCctf(e){this._imageDecodingCctf=e,void 0!=this._imageScatterVisual&&(this._imageScatterVisual.imageDecodingCctf=e),void 0!=this._imageScatterOverlayVisual&&(this._imageScatterOverlayVisual.imageDecodingCctf=e)}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e,void 0!=this._viewAxesVisual&&(this._viewAxesVisual.colourspaceModel=e),void 0!=this._visibleSpectrumVisual&&(this._visibleSpectrumVisual.colourspaceModel=e),void 0!=this._spectralLocusVisual&&(this._spectralLocusVisual.colourspaceModel=e),void 0!=this._pointerGamutVisual&&(this._pointerGamutVisual.colourspaceModel=e),void 0!=this._secondaryColourspaceVisual&&(this._secondaryColourspaceVisual.colourspaceModel=e),void 0!=this._primaryColourspaceVisual&&(this._primaryColourspaceVisual.colourspaceModel=e),void 0!=this._imageScatterVisual&&(this._imageScatterVisual.colourspaceModel=e),void 0!=this._imageScatterOverlayVisual&&(this._imageScatterOverlayVisual.colourspaceModel=e)}get viewAxesVisual(){return this._viewAxesVisual}set viewAxesVisual(e){throw new Error('"viewAxesVisual" property is read only!')}get visibleSpectrumVisual(){return this._visibleSpectrumVisual}set visibleSpectrumVisual(e){throw new Error('"visibleSpectrumVisual" property is read only!')}get spectralLocusVisual(){return this._spectralLocusVisual}set spectralLocusVisual(e){throw new Error('"spectralLocusVisual" property is read only!')}get pointerGamutVisual(){return this._pointerGamutVisual}set pointerGamutVisual(e){throw new Error('"pointerGamutVisual" property is read only!')}get secondaryColourspaceVisual(){return this._secondaryColourspaceVisual}set secondaryColourspaceVisual(e){throw new Error('"secondaryColourspaceVisual" property is read only!')}get primaryColourspaceVisual(){return this._primaryColourspaceVisual}set primaryColourspaceVisual(e){throw new Error('"primaryColourspaceVisual" property is read only!')}get imageScatterVisual(){return this._imageScatterVisual}set imageScatterVisual(e){throw new Error('"imageScatterVisual" property is read only!')}get imageScatterOverlayVisual(){return this._imageScatterOverlayVisual}set imageScatterOverlayVisual(e){throw new Error('"imageScatterOverlayVisual" property is read only!')}addViewAxesVisual(e){this._viewAxesVisual=new v(this,n({colourspaceModel:this._colourspaceModel},e||{})),this._viewAxesVisual.add()}addVisibleSpectrumVisual(e){this._visibleSpectrumVisual=new b(this._visibleSpectrumVisualGroup,n({colourspaceModel:this._colourspaceModel},e||{})),this._visibleSpectrumVisual.add()}addSpectralLocusVisual(e){this._spectralLocusVisual=new E(this._spectralLocusVisualGroup,n({colourspace:this._secondaryColourspace,colourspaceModel:this._colourspaceModel},e||{})),this._spectralLocusVisual.add()}addPointerGamutVisual(e){this._pointerGamutVisual=new V(this._pointerGamutVisualGroup,n({colourspaceModel:this._colourspaceModel},e||{})),this._pointerGamutVisual.add()}addSecondaryColourspaceVisual(e){this._secondaryColourspaceVisual=new w(this._secondaryColourspaceVisualGroup,n({name:"secondary-colourspace-visual",colourspace:this._secondaryColourspace,colourspaceModel:this._colourspaceModel,wireframe:!0,uniformOpacity:.25},e||{})),this._secondaryColourspaceVisual.add()}addPrimaryColourspaceVisual(e){this._primaryColourspaceVisual=new w(this._primaryColourspaceVisualGroup,n({name:"primary-colourspace-visual",colourspace:this._primaryColourspace,colourspaceModel:this._colourspaceModel},e||{})),this._primaryColourspaceVisual.add()}addImageScatterVisual(e){this._imageScatterVisual=new O(this._imageScatterVisualGroup,n({image:this._image,primaryColourspace:this._primaryColourspace,secondaryColourspace:this._secondaryColourspace,imageColourspace:this._imageColourspace,imageDecodingCctf:this._imageDecodingCctf,colourspaceModel:this._colourspaceModel},e||{})),this._imageScatterVisual.add()}addImageScatterOverlayVisual(e){this._imageScatterOverlayVisual=new O(this._imageScatterOverlayVisualGroup,n({name:"image-scatter-overlay-visual",image:this._image,primaryColourspace:this._primaryColourspace,secondaryColourspace:this._secondaryColourspace,imageColourspace:this._imageColourspace,imageDecodingCctf:this._imageDecodingCctf,colourspaceModel:this._colourspaceModel,uniformOpacity:.5},e||{})),this._imageScatterOverlayVisual.add()}isLoading(){return this._viewAxesVisual.loading||this._visibleSpectrumVisual.loading||this._spectralLocusVisual.loading||this._pointerGamutVisual.loading||this._secondaryColourspaceVisual.loading||this._primaryColourspaceVisual.loading||this._imageScatterVisual.loading||this._imageScatterOverlayVisual.loading}animate(){void 0!=this._imageScatterOverlayVisual&&void 0!=this._imageScatterOverlayVisual.visual&&(this._imageScatterOverlayVisual.visual.material.opacity=this._imageScatterOverlayVisual.uniformOpacity*(1+Math.sin(.0015*(new Date).getTime()))/2),super.animate()}}class G extends y{constructor(e,i){super(e,i),i=n({camera:{up:{x:0,y:1,z:0},near:.001,far:1e3}},i||{});var t=this.container.clientWidth/this.container.clientHeight;this._camera=new THREE.OrthographicCamera(-.5,.5,.5/t,-.5/t,i.camera.near,i.camera.far),this._camera.name="orthographic-camera",this._camera.up=new THREE.Vector3(i.camera.up.x,i.camera.up.y,i.camera.up.z),this._scene.add(this._camera),this._controls=new THREE.OrbitControls(this._camera,this.container),this._controls.enableRotate=!1}get camera(){return this._camera}set camera(e){throw new Error('"camera" property is read only!')}get controls(){return this._controls}set controls(e){throw new Error('"controls" property is read only!')}resizeToContainer(){super.resizeToContainer();var e=this.container.clientWidth,i=this.container.clientHeight;if(this.container.width!==e||this.container.height!==i){this.renderer.setSize(e,i);var t=this.container.clientWidth/this.container.clientHeight;this._camera.top=.5/t,this._camera.bottom=-.5/t,this._camera.updateProjectionMatrix()}}}class S extends C{constructor(e,i){super(e,n({name:"image-visual"},i||{})),this._image=i.image||"Rose.ProPhoto.jpg",this._primaryColourspace=i.primaryColourspace||"sRGB",this._secondaryColourspace=i.secondaryColourspace||"DCI-P3",this._imageColourspace=i.imageColourspace||"Primary",this._imageDecodingCctf=i.imageDecodingCctf||"sRGB",this._uniformOpacity=i.uniformOpacity||1,this._outOfPrimaryColourspaceGamut=i.outOfPrimaryColourspaceGamut||!1,this._outOfSecondaryColourspaceGamut=i.outOfSecondaryColourspaceGamut||!1,this._outOfPointerGamut=i.outOfPointerGamut||!1,this._saturate=i.saturate||!1,this._depth=i.depth||0}get image(){return this._image}set image(e){this._image=e,this.add()}get primaryColourspace(){return this._primaryColourspace}set primaryColourspace(e){this._primaryColourspace=e,this.add()}get secondaryColourspace(){return this._secondaryColourspace}set secondaryColourspace(e){this._secondaryColourspace=e,this.add()}get imageColourspace(){return this._imageColourspace}set imageColourspace(e){if(!["Primary","Secondary"].includes(e))throw new Error('"imageColourspace" value must be one of ["Primary", "Secondary"]!');this._imageColourspace=e,this.add()}get imageDecodingCctf(){return this._imageDecodingCctf}set imageDecodingCctf(e){this._imageDecodingCctf=e,this.add()}get uniformOpacity(){return this._uniformOpacity}set uniformOpacity(e){this._uniformOpacity=e,Object.keys(this.cache).forEach(function(i){this.cache[i].material.opacity=e}.bind(this))}get outOfPrimaryColourspaceGamut(){return this._outOfPrimaryColourspaceGamut}set outOfPrimaryColourspaceGamut(e){this._outOfPrimaryColourspaceGamut=e,this.add()}get outOfSecondaryColourspaceGamut(){return this._outOfSecondaryColourspaceGamut}set outOfSecondaryColourspaceGamut(e){this._outOfSecondaryColourspaceGamut=e,this.add()}get outOfPointerGamut(){return this._outOfPointerGamut}set outOfPointerGamut(e){this._outOfPointerGamut=e,this.add()}get saturate(){return this._saturate}set saturate(e){this._saturate=e,this.add()}get depth(){return this._depth}set depth(e){throw new Error('"depth" property is read only!')}route(){return u(`/image-data/${encodeURIComponent(this._image)}?`+`primaryColourspace=${encodeURIComponent(this._primaryColourspace)}&`+`secondaryColourspace=${encodeURIComponent(this._secondaryColourspace)}&`+`imageColourspace=${encodeURIComponent(this._imageColourspace)}&`+`imageDecodingCctf=${encodeURIComponent(this._imageDecodingCctf)}&`+`outOfPrimaryColourspaceGamut=${this._outOfPrimaryColourspaceGamut}&`+`outOfSecondaryColourspaceGamut=${this._outOfSecondaryColourspaceGamut}&`+`outOfPointerGamut=${this._outOfPointerGamut}&`+`saturate=${this._saturate}`)}create(e){var i=new THREE.PlaneGeometry(1,e.height/e.width),t=new THREE.DataTexture(Float32Array.from(e.data),e.width,e.height,THREE.RGBFormat,THREE.FloatType);if(t.needsUpdate=!0,1==this._uniformOpacity)var r=new THREE.MeshBasicMaterial({map:t});else r=new THREE.MeshBasicMaterial({map:t,alphaMap:t,transparent:!0,opacity:this._uniformOpacity});var a=new THREE.Mesh(i,r);return a.name=this.name,a.visible=this.visible,a.position.set(0,this._depth,0),a.rotation.set(THREE.Math.degToRad(-90),0,THREE.Math.degToRad(180)),a.scale.set(-1,1,1),a}fetch(e){var i=new THREE.FileLoader;i.setResponseType("json"),i.load(e,function(i){this.visual=this.create(i),this.cache[e]=this.visual,this.parent.add(this.visual),this._loading=!1}.bind(this),d.bind(this))}}class R extends G{constructor(e,i){super(e,i),i=n({renderer:{gammaOutput:!0},scene:{background:"#333333"},camera:{position:{x:0,y:1,z:0}},controls:{target:{x:0,y:0,z:0}},image:"Rose.ProPhoto.jpg",primaryColourspace:"sRGB",secondaryColourspace:"DCI-P3",imageColourspace:"Primary",imageDecodingCctf:"sRGB",colourspaceModel:"CIE xyY"},i||{}),this.renderer.gammaOutput=i.renderer.gammaOutput,this.scene.background=new THREE.Color(i.scene.background),this.camera.position.copy(new THREE.Vector3(i.camera.position.x,i.camera.position.y,i.camera.position.z)),this.controls.target=new THREE.Vector3(i.controls.target.x,i.controls.target.y,i.controls.target.z),this._image=i.image,this._primaryColourspace=i.primaryColourspace,this._secondaryColourspace=i.secondaryColourspace,this._imageColourspace=i.imageColourspace,this._imageDecodingCctf=i.imageDecodingCctf,this._colourspaceModel=i.colourspaceModel,this._imageVisualGroup=new THREE.Group,this._imageVisualGroup.name="image-visual-group",this._scene.add(this._imageVisualGroup),this._imageVisual=void 0,this._imageOverlayVisualGroup=new THREE.Group,this._imageOverlayVisualGroup.name="image-overlay-visual-group",this._scene.add(this._imageOverlayVisualGroup),this._imageOverlayVisual=void 0}get image(){return this._image}set image(e){this._image=e,void 0!=this._imageVisual&&(this._imageVisual.image=e),void 0!=this._imageOverlayVisual&&(this._imageOverlayVisual.image=e)}get primaryColourspace(){return this._primaryColourspace}set primaryColourspace(e){this._primaryColourspace=e,void 0!=this._imageOverlayVisual&&(this._imageOverlayVisual.primaryColourspace=e)}get secondaryColourspace(){return this._secondaryColourspace}set secondaryColourspace(e){this._secondaryColourspace=e,void 0!=this._imageOverlayVisual&&(this._imageOverlayVisual.secondaryColourspace=e)}get imageColourspace(){return this._imageColourspace}set imageColourspace(e){if(!["Primary","Secondary"].includes(e))throw new Error('"imageColourspace" value must be one of ["Primary", "Secondary"]!');this._imageColourspace=e,void 0!=this._imageOverlayVisual&&(this._imageOverlayVisual.imageColourspace=e)}get imageDecodingCctf(){return this._imageDecodingCctf}set imageDecodingCctf(e){this._imageDecodingCctf=e,void 0!=this._imageVisual&&(this._imageVisual.imageDecodingCctf=e),void 0!=this._imageOverlayVisual&&(this._imageOverlayVisual.imageDecodingCctf=e)}get colourspaceModel(){return this._colourspaceModel}set colourspaceModel(e){this._colourspaceModel=e}get imageVisual(){return this._imageVisual}set imageVisual(e){throw new Error('"imageVisual" property is read only!')}get imageOverlayVisual(){return this._imageOverlayVisual}set imageOverlayVisual(e){throw new Error('"imageOverlayVisual" property is read only!')}addImageVisual(e){this._imageVisual=new S(this._imageVisualGroup,n({name:"image-visual",image:this._image,primaryColourspace:this._primaryColourspace,secondaryColourspace:this._secondaryColourspace,imageColourspace:this._imageColourspace,imageDecodingCctf:this._imageDecodingCctf},e||{})),this._imageVisual.add()}addImageOverlayVisual(e){this._imageOverlayVisual=new S(this._imageOverlayVisualGroup,n({name:"image-overlay-visual",image:this._image,primaryColourspace:this._primaryColourspace,secondaryColourspace:this._secondaryColourspace,imageColourspace:this._imageColourspace,imageDecodingCctf:this._imageDecodingCctf,uniformOpacity:.5,depth:.5},e||{})),this._imageOverlayVisual.add()}isLoading(){return this._imageVisual.loading||this._imageOverlayVisual.loading}animate(){void 0!=this._imageOverlayVisual&&void 0!=this._imageOverlayVisual.visual&&(this._imageOverlayVisual.visual.material.opacity=this._imageOverlayVisual.uniformOpacity*(1+Math.sin(.0015*(new Date).getTime()))/2),super.animate()}}function x(e,i,t,r,a){if("Array"==a.constructor.name)var o=a;else if("Object"==a.constructor.name)o=Object.keys(a);o.sort();for(var s="<select>\n",c=0;c<o.length;c++)s+=`<option value="${o[c]}">${o[c]}</option>\n`;s+="</select>",t.domElement.children[0].innerHTML=s,t.domElement.children[0].selectedIndex=o.indexOf(r)}function T(e){e=e.domElement.children[0];for(var i=new Array,t=0;t<e.options.length;t++)i[t]=e.options[t].value;return i}t.d(i,"GamutView",function(){return M}),t.d(i,"ImageView",function(){return R}),t.d(i,"updateDropdown",function(){return x}),t.d(i,"dropdownOptions",function(){return T}),t.d(i,"isLinearFileFormat",function(){return g}),t.d(i,"info",function(){return p}),t.d(i,"saveFile",function(){return _}),t.d(i,"serverRoute",function(){return u}),t.d(i,"warning",function(){return m})}]);